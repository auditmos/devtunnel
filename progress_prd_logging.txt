## 2026-01-14: Core Structured Logging Infrastructure - DONE

Created logging/ package with:
- logging/levels.go: LogLevel (DEBUG/INFO/WARN/ERROR), ParseLevel(), ShouldLog()
- logging/fields.go: Fields map, WithField/WithFields/WithError, Sanitize() for sensitive keys
- logging/entry.go: LogEntry struct (timestamp, level, component, action, message, fields, error, trace_id)
- logging/formatter.go: JSONFormatter (JSONL, RFC3339 timestamps), HumanFormatter (TTY colors via go-isatty)
- logging/logger.go: Logger interface, StandardLogger (thread-safe, level filtering, sanitization), NopLogger

Tests: 26 tests in logging/*_test.go - all pass
Build: go build ./... OK

Next: CLI Logging Configuration Flags (--json, --log-level, --log-file)

## 2026-01-14: CLI Logging Configuration Flags - DONE

Added flags to both client and server commands:
- --json: output JSONL format
- --log-level: debug/info/warn/error (default: info)
- --log-file: write to file (default: stdout)

Changes:
- cmd/devtunnel/main.go: added initLogger() helper, updated runServer/runClient signatures
- tunnel/server.go: added Logger to ServerConfig, stores in Server struct
- tunnel/client.go: added Logger to ClientConfig, stores as log field
- dashboard/server.go: added Logger to ServerConfig, stores in Server struct

Tests: 12 new tests in cmd/devtunnel/main_test.go for flag existence and initLogger behavior
Build: go build ./... OK
Tests: go test ./... OK

Note: log.Printf calls still remain in tunnel/client.go and tunnel/server.go. Replacement is next PRD item.

Next: Client Structured Logging Integration

## 2026-01-14: Client Structured Logging Integration - DONE

Replaced all log.Printf calls in tunnel/client.go with structured logging:
- INFO [client] connect: "Connecting to server" [server_addr]
- INFO [client] connect: "Connected" [public_url, subdomain]
- ERROR [client] connect: "Connection failed" [error, retry_in]
- INFO [client] forward: "Request forwarded" [method, url, status_code, duration_ms, request_id]
- ERROR [client] forward: "Failed to forward/decode/create/read/encode" [error, ...]
- WARN [client] disconnect: "Connection lost"
- INFO [client] reconnect: "Reconnecting"

Changes:
- tunnel/client.go: removed "log" import, use c.log (logging.Logger)
- tunnel/protocol.go: added TraceID field to RequestFrame
- tunnel/client_logging_test.go: 8 new tests for client log output

Tests: 8 tests in client_logging_test.go
Build: go build ./... OK
Tests: go test ./... OK

Next: Server Structured Logging Integration

## 2026-01-14: Server Structured Logging Integration - DONE

Replaced all log.Printf in tunnel/server.go with structured logging:
- INFO [server] start: "Server listening" [addr, domain]
- INFO [server] start: "HTTPS enabled" / "HTTP enabled" [public_url]
- INFO [server] https: "HTTPS listening" [addr]
- WARN [server] https: "HTTPS listen failed, fallback to HTTP" [error]
- ERROR [server] https: "HTTPS serve error" [error]
- ERROR [server] websocket: "Upgrade failed" [error]
- ERROR [server] handshake: "Yamux server init failed" / "Accept stream failed" / "Handshake decode failed" / "Handshake response encode failed" [error]
- WARN [server] connect: "Connection limit exceeded" [subdomain]
- INFO [server] connect: "Client connected" [subdomain, public_url]
- INFO [server] disconnect: "Client disconnected" [subdomain]
- INFO [server] proxy: "Request proxied" [subdomain, method, path, trace_id]
- ERROR [server] proxy: "Open stream failed" / "Read body failed" / "Encode request failed" / "Decode response failed" [subdomain, error, trace_id]
- INFO [server] blob: "Blob saved" [blob_id, size]
- ERROR [server] blob: "Blob save failed" / "Blob get failed" [blob_id, error]
- ERROR [server] template: "Render failed" [template, error]

Added trace_id generation in proxyToTunnel and propagate via RequestFrame.TraceID.

Tests: 9 tests in tunnel/server_logging_test.go
Build: go build ./... OK
Tests: go test ./... OK

Next: Dashboard Structured Logging Integration
